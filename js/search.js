$(function(){function a(e,n){var t=e.slice(n,n+5).removeClass("back").addClass("start");clearTimeout(o),o=setTimeout(function(){t.addClass("end"),setTimeout(a.bind(this,e,(n+5)%10),100),setTimeout(function(){t.addClass("back").removeClass("start end")},1500)},5e3)}function e(){$.ajax({url:window.api.getTownsUrl,data:{},async:!0,cache:!1,dataType:"json",type:"GET",beforeSend:function(){}}).done(function(e){if(e.status){var n=$("<div />").attr("id","no_data").addClass("show").append($("<div />").addClass("title").text("您可以試著搜尋..")).append($("<div />").addClass("towns").append(e.towns.map(function(a){return $("<a />").text(a.name).click(function(){window.location.hash=encodeURIComponent($(this).text())})}))).appendTo($container);setTimeout(a.bind(this,n.find("a"),0),100),window.closeLoading()}}).fail(function(a){ajaxError(a)}).complete(function(){})}function n(a){$map=$("<div />").attr("id","map"),$loadingData=$("<div />").addClass("loading_data").text("資料讀取中.."),$("<div />").addClass("map").append(Array.apply(null,Array(4)).map(function(){return $("<i />")})).append($map).append($loadingData).appendTo($container);var e=new google.maps.Map($map.get(0),{zoom:14,zoomControl:!0,scrollwheel:!0,scaleControl:!0,mapTypeControl:!1,navigationControl:!0,streetViewControl:!1,disableDoubleClickZoom:!0}),n=initWeatherFeature(a,e,!0);e.setCenter(n.position),n.setMap(e),google.maps.event.addListener(e,"zoom_changed",getWeathers.bind(this,e,n.id,$loadingData,!1)),google.maps.event.addListener(e,"idle",getWeathers.bind(this,e,n.id,$loadingData,!1)),window.closeLoading()}var t=window.location.hash.trim().slice(1);window.onhashchange=function(){location.reload()};var o=null;$container=$("#container");var d=$("<input />").addClass("search").attr("type","text").attr("placeholder","快來搜尋一下天氣吧！").val(decodeURIComponent(t)).keyup(function(a){13==a.keyCode&&$(this).val().trim().length&&(window.location.hash=encodeURIComponent($(this).val().trim()))}),i=$("<button />").addClass("go_search").text("搜尋").click(function(){d.val().trim().length&&(window.location.hash=encodeURIComponent(d.val().trim()))}),s=$("<div />").addClass("r").append($("<div />").addClass("loading")),l=$("<div />").attr("id","search").append($("<a />").attr("href",window.url+"index.html").addClass("l").append($("<div />").addClass("logo").append($("<span />").text("Weather"))).append($("<div />").addClass("title").text("Maps"))).append($("<div />").addClass("c").append(d).append(i)).append(s).prependTo($container);t.length?$.ajax({url:window.api.getWeatherByNameUrl,data:{name:t},async:!0,cache:!1,dataType:"json",type:"POST",beforeSend:function(){}}).done(function(a){a.status?n(a.weather):e()}).fail(function(a){ajaxError(a)}).complete(function(){}):e(),getLocalInfo(function(a){s.empty().append($(a.weather))},function(){l.addClass("no_weather")})});