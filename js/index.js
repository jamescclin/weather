$(function(){function a(){$("<div />").addClass("no_data").append("系統維修中，已經聯絡工程師，他正在爆肝中..").append($("<br />")).append("請稍後一下下再試試吧：）").appendTo(o)}function e(){var a=getStorage("weather_maps_follow_postal_codes");a||(a=[]),setStorage("weather_maps_follow_postal_codes",a.filter(function(a){return a.id!=$(this).data("id")}.bind($(this)))),location.reload()}function t(){var a=prompt("輸入您想追蹤的地點：",n+" "+i);a&&(a=a.trim(),a.length&&$.ajax({url:window.api.getWeatherByNameUrl,data:{name:a},async:!0,cache:!1,dataType:"json",type:"POST",beforeSend:function(){}}).done(function(a){if(!a.status)return alert("取得地點失敗！"),void 0;var e=getStorage("weather_maps_follow_postal_codes");e||(e=[]);var t=[{id:a.weather.id}];e=e.diff(t,"id");var d=t.diff(e,"id");e=e.concat(d),setStorage("weather_maps_follow_postal_codes",e),location.reload()}).fail(function(a){ajaxError(a)}).complete(function(){}))}function d(d,n){var i=$("<div />").addClass("units").appendTo(o);if(d.length<1&&n.length<1)return a();if(n.length>0&&i.append(n.map(function(a){return $("<div />").addClass("unit").append($("<h2 />").text(a.title)).append($("<a />").attr("href","town.html#"+encodeURIComponent(a.info.id)).append($("<div />").addClass("l").append($(a.info.content))).append($("<div />").addClass("r").append($("<div />").addClass("describe").text(a.info.weather.describe)).append($("<div />").addClass("sub_describe").append($("<div />").addClass("humidity").text("溫濕度："+a.info.weather.humidity+"%")).append($("<div />").addClass("rainfall").text("降雨量："+a.info.weather.rainfall+"mm"))).append($("<div />").addClass("created_at").data("time",a.info.weather.created_at).text(a.info.weather.created_at).timeago()))).append(a.info.add?$("<div />").addClass("del").html("&#10006;").data("id",a.info.id).click(e):null)})),"undefined"!=typeof Storage&&$("<div />").addClass("unit").addClass("add").append(Array.apply(null,Array(5)).map(function(a,e){return $("<div />").text(4==e?"新增關注追蹤地區！":"")})).click(t).appendTo(i),d.length>0){$("<div />").addClass("line").append($("<div />")).append($("<div />").text("特報")).append($("<div />")).appendTo(o);var p=$("<div />").addClass("specials").append(d.map(function(a){return $("<div />").addClass("special").append($("<h2 />").text(a.special.title+"特報")).append($("<div />").addClass("towns").append(a.towns.map(function(a){return $("<a />").attr("href","town.html#"+encodeURIComponent(a.id)).text(a.name)}))).append($("<div />").addClass("describe").text(a.special.describe).prepend($("<img />").attr("src",a.special.icon))).append($("<div />").addClass("at").data("time",a.special.at).text(a.special.at).timeago())})).appendTo(o);new Masonry(p.get(0),{itemSelector:".special",columnWidth:1,transitionDuration:"0.3s",visibleStyle:{opacity:1,transform:"none"}})}window.closeLoading()}var n="雲林縣",i="北港鎮",o=$("#container");getLocalInfo(function(a){n=a.town.category,i=a.town.name}),$.ajax({url:window.api.getIndexData,data:{postal_codes:getStorage("weather_maps_follow_postal_codes")},async:!0,cache:!1,dataType:"json",type:"POST",beforeSend:function(){}}).done(function(e){e.status?d(e.specials,e.units):a()}).fail(function(a){ajaxError(a)}).complete(function(){})});